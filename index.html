<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨Ø§Øª Ø´Ø±ÙƒØ© Ù‚Ù…Ø± Ø§Ù„Ø®Ù„ÙŠØ¬</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="shortcut icon" href="logo.png">
    
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update, get, set, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCjlwkV9u7wFWtjhKZSeACtU5DTAbMZois",
            authDomain: "qamar-system.firebaseapp.com",
            databaseURL: "https://qamar-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "qamar-system",
            storageBucket: "qamar-system.firebasestorage.app",
            messagingSenderId: "409311893648",
            appId: "1:409311893648:web:a56b3d46ad6be716312015",
            measurementId: "G-YCEMSWFX66"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, 'transactions');
        const archiveRef = ref(db, 'archive');

        async function syncWithSheets(entryData, id, action) {
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzp1UmoUxnt2-VIPaBCLgaZ7myl2mRDo2flAhB4LMEdrAt-FqBFfypHijXt6nmWcvv8Ug/exec';
            const payload = { ...entryData, id: id, action: action };
            try {
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (error) { console.error(error); }
        }

        window.processEntry = function() {
            const desc = document.getElementById('desc').value;
            let amount = parseFloat(document.getElementById('amount').value);
            const currency = document.getElementById('currency').value;
            const type = document.getElementById('type').value;
            const method = document.getElementById('method').value;
            const employee = document.getElementById('employee').value;
            const date = new Date().toLocaleDateString('ar-EG');

            if (!desc || isNaN(amount)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ø¹ÙŠÙ†ÙŠ");
            
            let finalAmount = (currency === "IQD") ? amount * 1000 : amount;
            const entryData = { date, desc, type, method, amount: finalAmount, currency, employee };

            if (window.editKey) {
                update(ref(db, 'transactions/' + window.editKey), entryData);
                syncWithSheets(entryData, window.editKey, "edit");
                window.editKey = null;
                document.getElementById('submitBtn').innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
                document.getElementById('submitBtn').classList.remove('update-mode');
            } else {
                const newRef = push(dbRef, entryData);
                syncWithSheets(entryData, newRef.key, "add");
            }
            document.getElementById('desc').value = "";
            document.getElementById('amount').value = "";
        };

        onValue(dbRef, (snapshot) => { 
            if(!window.viewingArchive) {
                renderAll(snapshot.val()); 
            }
        });

        window.deleteEntry = function(id) {
            if(window.viewingArchive) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ");
            if(confirm("ØªØ±ÙŠØ¯ ØªØ­Ø°Ù Ù‡Ø§ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ")) {
                syncWithSheets({ date: "", desc: "", employee: "", type: "", method: "", amount: 0, currency: "" }, id, "delete");
                remove(ref(db, 'transactions/' + id));
            }
        };

        window.editEntry = function(id, dataStr) {
            if(window.viewingArchive) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ");
            const itm = JSON.parse(decodeURIComponent(dataStr));
            window.editKey = id;
            document.getElementById('desc').value = itm.desc;
            document.getElementById('amount').value = itm.currency === "IQD" ? itm.amount / 1000 : itm.amount;
            document.getElementById('currency').value = itm.currency;
            document.getElementById('type').value = itm.type;
            document.getElementById('method').value = itm.method;
            document.getElementById('employee').value = itm.employee || "Ù‡Ù†Ø¯";
            const btn = document.getElementById('submitBtn');
            btn.innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
            btn.classList.add('update-mode');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.archiveAndClear = async function() {
            if(!confirm("ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù†Ø³Ø®Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆÙ…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ.")) return;
            const snapshot = await get(dbRef);
            const data = snapshot.val();
            if (!data) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø£Ø±Ø´ÙØ©!");

            const todayStr = new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const timestamp = Date.now();
            
            const archiveData = {
                savedAt: timestamp,
                displayDate: todayStr,
                entries: data
            };

            await push(archiveRef, archiveData);
            await remove(dbRef);
            
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        };

        window.openArchiveModal = function() {
            document.getElementById('archiveModal').style.display = 'flex';
            loadArchiveList();
        }

        window.closeArchiveModal = function() {
            document.getElementById('archiveModal').style.display = 'none';
        }

        async function loadArchiveList() {
            const listDiv = document.getElementById('archiveList');
            listDiv.innerHTML = '<p style="text-align:center; color:#64748b;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ...</p>';
            
            const snapshot = await get(archiveRef);
            listDiv.innerHTML = '';
            
            if (snapshot.exists()) {
                const archives = snapshot.val();
                const sortedKeys = Object.keys(archives).sort((a,b) => archives[b].savedAt - archives[a].savedAt);
                
                sortedKeys.forEach(key => {
                    const item = archives[key];
                    const date = new Date(item.savedAt).toLocaleTimeString('ar-EG');
                    
                    listDiv.innerHTML += `
                        <div class="archive-item" onclick="loadArchiveDay('${key}')">
                            <div class="archive-date">ğŸ“… ${item.displayDate}</div>
                            <div class="archive-time">ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸: ${date}</div>
                        </div>
                    `;
                });
            } else {
                listDiv.innerHTML = '<p style="text-align:center; color:#64748b;">Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
            }
        }

        window.loadArchiveDay = function(key) {
            get(child(archiveRef, key)).then((snapshot) => {
                if(snapshot.exists()) {
                    const archiveData = snapshot.val();
                    window.viewingArchive = true;
                    document.getElementById('reportTitle').innerText = "Ø£Ø±Ø´ÙŠÙ ÙŠÙˆÙ…: " + archiveData.displayDate;
                    document.querySelector('.print-header-top h1').innerText = "Ù†Ø³Ø®Ø© Ø£Ø±Ø´ÙŠÙÙŠØ©";
                    document.getElementById('printDateDisplay').innerText = archiveData.displayDate;

                    document.querySelector('.input-section').style.display = 'none';
                    document.querySelector('.controls').style.display = 'none';
                    document.getElementById('archiveControls').style.display = 'flex';
                    document.getElementById('archiveModal').style.display = 'none';

                    renderAll(archiveData.entries);
                }
            });
        }

        window.exitArchiveMode = function() {
            window.viewingArchive = false;
            document.getElementById('reportTitle').innerText = "Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© | Ø´Ø±ÙƒØ© Ù‚Ù…Ø± Ø§Ù„Ø®Ù„ÙŠØ¬";
            document.querySelector('.print-header-top h1').innerText = "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª";
            
            document.querySelector('.input-section').style.display = 'grid';
            document.querySelector('.controls').style.display = 'flex';
            document.getElementById('archiveControls').style.display = 'none';
            
            get(dbRef).then((snap) => renderAll(snap.val()));
        }

        window.printReport = function() {
            if(!window.viewingArchive) {
                const now = new Date();
                document.getElementById('printDateDisplay').innerText = now.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            }
            window.print();
        };

        function renderAll(data) {
            const body = document.getElementById('tableBody');
            body.innerHTML = "";
            
            let inIQD = 0, outIQD = 0, mstIQD = 0, znIQD = 0, unpIQD = 0, cashNetIQD = 0;
            let inUSD = 0, outUSD = 0, mstUSD = 0, znUSD = 0, unpUSD = 0, cashNetUSD = 0;

            if (data) {
                Object.keys(data).forEach((id) => {
                    const item = data[id];
                    const isUnpaid = item.method === "ØºÙŠØ± ÙˆØ§ØµÙ„";
                    const isPrepaid = item.method === "ÙˆØ§ØµÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹";
                    const isMaster = item.method === "Ù…Ø§Ø³ØªØ± ÙƒØ§Ø±Ø¯";
                    const isZain = item.method === "Ø²ÙŠÙ† ÙƒØ§Ø´";
                    const isCash = item.method === "ÙƒØ§Ø´";
                    const itemData = encodeURIComponent(JSON.stringify(item));
                    
                    const actionButtons = window.viewingArchive ? 
                        '<span class="archived-tag">Ù…Ø¤Ø±Ø´Ù</span>' : 
                        `<div class="action-btns">
                            <button class="edit-btn" onclick="editEntry('${id}', '${itemData}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="delete-btn" onclick="deleteEntry('${id}')">Ø­Ø°Ù</button>
                        </div>`;

                    body.innerHTML += `<tr>
                        <td class="text-muted">${item.date}</td>
                        <td class="font-medium">${item.employee || '-'}</td>
                        <td>${item.desc}</td>
                        <td><span class="status-badge ${item.type === 'ÙˆØ§Ø±Ø¯' ? 'status-in' : 'status-out'}">${item.type}</span></td>
                        <td><span class="method-text ${isUnpaid ? 'text-unpaid' : (isPrepaid ? 'text-prepaid' : '')}">${item.method}</span></td>
                        <td class="amount-cell">${item.amount.toLocaleString()}</td>
                        <td class="currency-column font-medium">${item.currency === 'IQD' ? 'Ø¯.Ø¹' : '$'}</td>
                        <td class="delete-column">${actionButtons}</td>
                    </tr>`;

                    if (!isPrepaid) {
                        let val = (item.type === "ÙˆØ§Ø±Ø¯" ? item.amount : -item.amount);
                        if (item.currency === "IQD") {
                            if (isUnpaid) unpIQD += item.amount;
                            else {
                                if (item.type === "ÙˆØ§Ø±Ø¯") inIQD += item.amount; else outIQD += item.amount;
                                if (isMaster) mstIQD += val;
                                if (isZain) znIQD += val;
                                if (isCash) cashNetIQD += val; 
                            }
                        } else {
                            if (isUnpaid) unpUSD += item.amount;
                            else {
                                if (item.type === "ÙˆØ§Ø±Ø¯") inUSD += item.amount; else outUSD += item.amount;
                                if (isMaster) mstUSD += val;
                                if (isZain) znUSD += val;
                                if (isCash) cashNetUSD += val; 
                            }
                        }
                    }
                });
            }
            updateUI('IQD', inIQD, outIQD, mstIQD, znIQD, unpIQD, cashNetIQD);
            updateUI('USD', inUSD, outUSD, mstUSD, znUSD, unpUSD, cashNetUSD);
        }

        function updateUI(curr, inc, exp, mst, zn, unp, cashNet) {
            const netTotal = inc - exp;
            document.getElementById(`net${curr}_card`).innerText = netTotal.toLocaleString();
            document.getElementById(`treasury${curr}`).innerText = cashNet.toLocaleString();
            document.getElementById(`totalIn${curr}_card`).innerText = inc.toLocaleString();
            document.getElementById(`totalOut${curr}_card`).innerText = exp.toLocaleString();
            document.getElementById(`master${curr}_card`).innerText = mst.toLocaleString();
            document.getElementById(`zain${curr}_card`).innerText = zn.toLocaleString();
            document.getElementById(`unpaid${curr}_card`).innerText = unp.toLocaleString();
        }
    </script>

    <style>
        :root { 
            --royal-green: #004d40;     
            --royal-hover: #00332a;     
            --royal-light: #e6f0ef;     
            
            --bg-app: #f8fafc;          
            --bg-card: #ffffff;
            --text-main: #334155;
            --text-muted: #64748b;
            --border-color: #cbd5e1;    
            --border-light: #e2e8f0;
            --success: #059669;
            --danger: #dc2626;
            --warning: #d97706;
        }
        
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg-app);
            color: var(--text-main); 
            direction: rtl; 
            padding: 20px;
            font-size: 14px;
        }

        .container { 
            max-width: 1250px; 
            margin: 0 auto; 
            background: var(--bg-card);
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); 
            border: 1px solid var(--border-light);
            border-top: 5px solid var(--royal-green); 
        }

        .print-header-top { display: none; }
        
        h2.ui-title { 
            color: var(--royal-green); 
            font-weight: 800; 
            margin-bottom: 25px;
            font-size: 22px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
        }

        .input-section { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
            gap: 12px; 
            background: #f1f5f9; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 30px; 
            border: 1px solid var(--border-light);
            align-items: center;
        }

        @media (min-width: 1024px) {
            .input-section { grid-template-columns: 1fr 2fr 1.2fr 1fr 1fr auto; }
        }

        input, select { 
            font-family: 'Cairo', sans-serif; 
            padding: 10px 12px; 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 14px; 
            color: var(--text-main);
            background: var(--bg-card);
            transition: border-color 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        
        input:focus, select:focus { 
            border-color: var(--royal-green); 
            box-shadow: 0 0 0 3px rgba(0, 77, 64, 0.1); 
        }

        .add-btn { 
            background-color: var(--royal-green);
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px;
            padding: 10px 20px;
            border-radius: 6px;
            transition: background-color 0.2s; 
            font-family: 'Cairo', sans-serif;
        }
        .add-btn:hover { background-color: var(--royal-hover); }
        .update-mode { background-color: var(--warning) !important; }
        
        .table-responsive {
            overflow-x: auto;
            margin-bottom: 35px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            white-space: nowrap;
            background: var(--bg-card);
        }
        
        th, td { 
            padding: 12px 16px; 
            text-align: right; 
            font-size: 14px; 
            border: 1px solid var(--border-color); 
        }
        
        th { 
            background-color: var(--royal-light); 
            color: var(--royal-green); 
            font-weight: 800; 
            font-size: 13px;
        }
        
        tbody tr:nth-child(even) { background-color: #f8fafc; } 
        tbody tr:hover { background-color: #f1f5f9; }

        .font-medium { font-weight: 700; color: var(--royal-green); }
        .text-muted { color: var(--text-muted); font-size: 13px; }
        .amount-cell { font-weight: 700; font-family: 'Courier New', Courier, monospace; font-size: 15px; text-align: left; direction: ltr;}
        
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .status-in { background: #dcfce7; color: var(--success); }
        .status-out { background: #fee2e2; color: var(--danger); }

        .method-text { font-weight: 500; }
        .text-unpaid { color: var(--warning); font-weight: 700; }
        .text-prepaid { color: var(--text-muted); font-style: italic; }
        
        .action-btns { display: flex; gap: 6px; }
        .edit-btn, .delete-btn { 
            border: 1px solid var(--border-color); cursor: pointer; padding: 4px 10px; border-radius: 4px; font-weight: 600; font-size: 12px; font-family: 'Cairo', sans-serif; background: var(--bg-card); transition: 0.2s;
        }
        .edit-btn { color: var(--royal-green); }
        .edit-btn:hover { background: var(--royal-light); border-color: var(--royal-green); }
        .delete-btn { color: var(--danger); }
        .delete-btn:hover { background: #fef2f2; border-color: #fecaca; }
        .archived-tag { font-size: 12px; color: var(--text-muted); background: var(--bg-app); padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border-light); }
        
        .summary-title { color: var(--royal-green); margin-bottom: 20px; font-weight: 800; font-size: 18px; border-bottom: 1px solid var(--border-light); padding-bottom: 10px; }
        
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        
        .summary-card { 
            background: var(--bg-card); 
            border-radius: 8px; 
            padding: 20px; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-top: 4px solid var(--royal-green); 
        }
        .summary-card.usd { border-top-color: var(--warning); } 
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-header h3 { margin: 0; font-size: 16px; font-weight: 700; color: #0f172a; }
        .currency-tag { font-size: 12px; font-weight: 700; color: var(--royal-green); background: var(--royal-light); padding: 4px 8px; border-radius: 4px; border: 1px solid #b2dfdb; }
        .usd .currency-tag { color: var(--warning); background: #fffbeb; border-color: #fde68a; }

        .net-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .net-section { padding: 15px; border-radius: 6px; border: 1px solid var(--border-light); background: var(--bg-app); }
        .net-section.highlight { background: #f0fdf4; border-color: #bbf7d0; }
        
        .net-label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 6px; font-weight: 600; }
        .net-value { display: block; font-size: 22px; font-weight: 800; color: #0f172a; direction: ltr; text-align: left;}
        .treasury-val { color: var(--success); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-light); }
        .stat-item { padding: 10px; border: 1px solid var(--border-light); border-radius: 6px; background: var(--bg-app); }
        .stat-label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; }
        .stat-value { font-weight: 800; font-size: 16px; direction: ltr; text-align: left; display: block;}
        .stat-item.in .stat-value { color: var(--success); }
        .stat-item.out .stat-value { color: var(--danger); }

        .details-list { list-style: none; font-size: 13px; }
        .details-list li { display: flex; justify-content: space-between; padding: 10px 15px; border: 1px solid var(--border-light); margin-bottom: 6px; border-radius: 6px; background: var(--bg-card); }
        .details-list li span:first-child { color: var(--text-main); font-weight: 600;}
        .details-list li span:last-child { font-weight: 700; font-family: 'Courier New', Courier, monospace; direction: ltr;}
        
        .controls { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 30px; border-top: 1px solid var(--border-light); padding-top: 20px; }
        .btn-action { 
            padding: 10px 18px; border: 1px solid var(--border-color); border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px; 
            font-family: 'Cairo', sans-serif; background: var(--bg-card); color: var(--text-main); transition: 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .btn-action:hover { background: #f1f5f9; border-color: #94a3b8; }
        
        .btn-print { border-color: var(--royal-green); color: var(--royal-green); }
        .btn-print:hover { background: var(--royal-light); }
        .btn-clear { color: var(--danger); border-color: #fca5a5; }
        .btn-clear:hover { background: #fef2f2; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(15, 23, 42, 0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: var(--bg-card); padding: 24px; width: 100%; max-width: 450px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); border: 1px solid var(--border-light); border-top: 4px solid var(--royal-green); }
        .close-modal { float: left; color: var(--text-muted); font-size: 24px; cursor: pointer; line-height: 1; }
        .close-modal:hover { color: #0f172a; }
        
        .archive-list { max-height: 300px; overflow-y: auto; margin-top: 20px; }
        .archive-item { padding: 12px 15px; border: 1px solid var(--border-light); margin-bottom: 8px; border-radius: 6px; cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between; background: var(--bg-app); }
        .archive-item:hover { border-color: var(--royal-green); background: var(--royal-light); }
        .archive-date { font-weight: 600; font-size: 14px; color: #0f172a; }
        .archive-time { font-size: 12px; color: var(--text-muted); }

        @media print {
            @page { size: A4 portrait; margin: 1cm; }
            body { background: white !important; padding: 0; font-size: 12px; }
            .container { box-shadow: none; border: none; width: 100%; padding: 0; }
            .input-section, .controls, .delete-column, .ui-title, .action-btns, .btn-archive, #archiveControls { display: none !important; }
            .currency-column { display: none !important; }

            .print-header-top { display: flex !important; flex-direction: column; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
            .print-header-top h1 { margin: 0; font-size: 20px; font-weight: 800; color: black; }
            .print-header-top p { margin: 4px 0 0 0; color: black; font-weight: 600; }
            
            .table-responsive { border: none; margin-bottom: 20px; overflow: visible; }
            table { border: 2px solid #000 !important; }
            th, td { border: 1px solid #000 !important; color: #000 !important; padding: 6px; }
            th { background-color: #f3f3f3 !important; } 
            
            .status-badge { padding: 0; background: none !important; color: #000 !important; }
            
            .summary-title { font-size: 16px; border-bottom: 1px solid #000; margin-bottom: 10px; color: black; }
            .summary-grid { display: grid !important; grid-template-columns: 1fr 1fr; gap: 15px; page-break-inside: avoid; }
            .summary-card { border: 2px solid #000 !important; padding: 10px !important; border-radius: 0; box-shadow: none !important; }
            
            .card-header h3 { font-size: 14px; }
            .currency-tag { display: none; }
            
            .net-wrapper { gap: 10px; margin-bottom: 10px; }
            .net-section { padding: 6px !important; border: 1px solid #000 !important; background: transparent !important; }
            .net-label { font-size: 10px !important; color: #000 !important; }
            .net-value { font-size: 14px !important; color: black !important; }
            
            .stats-grid { gap: 10px !important; margin-bottom: 10px !important; border-bottom: 1px solid #000; padding-bottom: 10px; }
            .stat-item { border: 1px solid #000 !important; padding: 4px !important; }
            .stat-label { color: black !important; font-size: 10px !important; }
            .stat-item .stat-value { color: #000 !important; font-size: 12px !important; }
            
            .details-list li { border: 1px solid #000 !important; padding: 4px 8px !important; margin-bottom: 2px !important; }
            .details-list li span { color: #000 !important; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="print-header-top">
        <h1>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª - Ø´Ø±ÙƒØ© Ù‚Ù…Ø± Ø§Ù„Ø®Ù„ÙŠØ¬</h1>
        <p id="printDateDisplay"></p>
    </div>
    
    <h2 class="ui-title" id="reportTitle">Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© | Ø´Ø±ÙƒØ© Ù‚Ù…Ø± Ø§Ù„Ø®Ù„ÙŠØ¬</h2>
    
    <div class="input-section">
        <select id="employee">
            <option value="Ù‡Ù†Ø¯">Ù‡Ù†Ø¯</option>
            <option value="ØºÙŠØ«">ØºÙŠØ«</option>
            <option value="ÙŠÙˆÙ†Ø³">ÙŠÙˆÙ†Ø³</option>
        </select>
        <input type="text" id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
        <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
        <select id="currency">
            <option value="IQD">Ø¯.Ø¹</option>
            <option value="USD">$ Ø¯ÙˆÙ„Ø§Ø±</option>
        </select>
        <select id="type">
            <option value="ÙˆØ§Ø±Ø¯">ÙˆØ§Ø±Ø¯</option>
            <option value="ØµØ§Ø¯Ø±">ØµØ§Ø¯Ø±</option>
        </select>
        <select id="method">
            <option value="ÙƒØ§Ø´">ÙƒØ§Ø´</option>
            <option value="Ù…Ø§Ø³ØªØ± ÙƒØ§Ø±Ø¯">Ù…Ø§Ø³ØªØ± ÙƒØ§Ø±Ø¯</option>
            <option value="Ø²ÙŠÙ† ÙƒØ§Ø´">Ø²ÙŠÙ† ÙƒØ§Ø´</option>
            <option value="ØºÙŠØ± ÙˆØ§ØµÙ„">ØºÙŠØ± ÙˆØ§ØµÙ„</option>
            <option value="ÙˆØ§ØµÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹">ÙˆØ§ØµÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹</option>
        </select>
        <button class="add-btn" id="submitBtn" onclick="processEntry()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„ÙˆØµÙ</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th class="currency-column">Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                    <th class="delete-column">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <h3 class="summary-title">Ø§Ù„Ø®Ù„Ø§ØµØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
    
    <div class="summary-grid">
        <div class="summary-card iqd">
            <div class="card-header">
                <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ</h3>
                <span class="currency-tag">IQD</span>
            </div>
            
            <div class="net-wrapper">
                <div class="net-section">
                    <span class="net-label">Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span>
                    <span class="net-value" id="netIQD_card">0</span>
                </div>
                <div class="net-section highlight">
                    <span class="net-label">ØµØ§ÙÙŠ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© (ÙƒØ§Ø´)</span>
                    <span class="net-value treasury-val" id="treasuryIQD">0</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item in">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø±Ø¯</span>
                    <span class="stat-value" id="totalInIQD_card">0</span>
                </div>
                <div class="stat-item out">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§Ø¯Ø±</span>
                    <span class="stat-value" id="totalOutIQD_card">0</span>
                </div>
            </div>
            
            <ul class="details-list">
                <li><span>Ø±ØµÙŠØ¯ Ù…Ø§Ø³ØªØ± ÙƒØ§Ø±Ø¯</span> <span id="masterIQD_card">0</span></li>
                <li><span>Ø±ØµÙŠØ¯ Ø²ÙŠÙ† ÙƒØ§Ø´</span> <span id="zainIQD_card">0</span></li>
                <li><span>Ø§Ù„Ø¯ÙŠÙˆÙ† (ØºÙŠØ± ÙˆØ§ØµÙ„)</span> <span id="unpaidIQD_card">0</span></li>
            </ul>
        </div>

        <div class="summary-card usd">
            <div class="card-header">
                <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ</h3>
                <span class="currency-tag">USD</span>
            </div>
            
            <div class="net-wrapper">
                <div class="net-section">
                    <span class="net-label">Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span>
                    <span class="net-value" id="netUSD_card">0</span>
                </div>
                <div class="net-section highlight">
                    <span class="net-label">ØµØ§ÙÙŠ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© (ÙƒØ§Ø´)</span>
                    <span class="net-value treasury-val" id="treasuryUSD">0</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item in">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø±Ø¯</span>
                    <span class="stat-value" id="totalInUSD_card">0</span>
                </div>
                <div class="stat-item out">
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§Ø¯Ø±</span>
                    <span class="stat-value" id="totalOutUSD_card">0</span>
                </div>
            </div>
            
            <ul class="details-list">
                <li><span>Ø±ØµÙŠØ¯ Ù…Ø§Ø³ØªØ± ÙƒØ§Ø±Ø¯</span> <span id="masterUSD_card">0</span></li>
                <li><span>Ø±ØµÙŠØ¯ Ø²ÙŠÙ† ÙƒØ§Ø´</span> <span id="zainUSD_card">0</span></li>
                <li><span>Ø§Ù„Ø¯ÙŠÙˆÙ† (ØºÙŠØ± ÙˆØ§ØµÙ„)</span> <span id="unpaidUSD_card">0</span></li>
            </ul>
        </div>
    </div>

    <div class="controls">
        <button class="btn-action btn-archive" onclick="openArchiveModal()">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
        <button class="btn-action btn-print" onclick="printReport()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="btn-action btn-clear" onclick="archiveAndClear()">Ø£Ø±Ø´ÙØ© ÙˆØªØµÙÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
    </div>

    <div class="controls" id="archiveControls" style="display:none">
        <button class="btn-action btn-print" onclick="printReport()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
        <button class="btn-action" onclick="exitArchiveMode()">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
    </div>

    <div id="archiveModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeArchiveModal()">&times;</span>
            <h3 style="margin-bottom: 5px; font-size: 16px; color: var(--royal-green);">Ø³Ø¬Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ©</h3>
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
            <div id="archiveList" class="archive-list"></div>
        </div>
    </div>

</div>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then((reg) => console.log('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ âœ…', reg))
                .catch((err) => console.log('Ø§ÙƒÙˆ Ø®Ù„Ù„ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ âŒ', err));
        });
    }
</script>

</body>
</html>